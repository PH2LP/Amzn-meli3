# ğŸš« Sistema de Filtrado de Marcas Prohibidas

ProtecciÃ³n automÃ¡tica contra publicaciÃ³n de productos de marcas restringidas por MercadoLibre.

---

## ğŸ¯ Â¿QuÃ© hace?

Bloquea automÃ¡ticamente la publicaciÃ³n de productos de marcas que:
- EstÃ¡n prohibidas por MercadoLibre
- Tienen restricciones de propiedad intelectual
- Requieren autorizaciÃ³n especial del fabricante

---

## ğŸ“‹ Lista de Marcas Bloqueadas

Actualmente bloqueadas (actualizado 2025-11-08):

- âœ… Adidas
- âœ… Biotherm
- âœ… Carolina Herrera
- âœ… Converse
- âœ… It Cosmetics
- âœ… KÃ©rastase
- âœ… Kiehl's
- âœ… Jean Paul Gaultier
- âœ… LancÃ´me
- âœ… Nike
- âœ… Nina Ricci
- âœ… Paco Rabanne
- âœ… Ralph Lauren
- âœ… Urban Decay

---

## âš™ï¸ Â¿CÃ³mo Funciona?

### 1. VerificaciÃ³n AutomÃ¡tica en Pipeline

Cada vez que el pipeline intenta publicar un producto:

```
1. Extrae la marca del producto (campo "brand")
2. Compara con la lista de marcas prohibidas
3. Si coincide â†’ Bloquea y saltea el producto
4. Si no coincide â†’ ContinÃºa con la publicaciÃ³n normal
```

### 2. DetecciÃ³n Inteligente

El sistema detecta variaciones:

- **Match exacto**: "Nike" = bloqueado
- **Match parcial**: "Nike Pro" = bloqueado (contiene "Nike")
- **Case insensitive**: "NIKE", "nike", "Nike" = todos bloqueados

---

## ğŸš€ Uso

### AutomÃ¡tico (Recomendado)

El filtro estÃ¡ **integrado automÃ¡ticamente** en el pipeline principal. No necesitÃ¡s hacer nada.

```bash
# Ejecutar pipeline normal
./venv/bin/python3 src/integrations/mainglobal.py

# Si encuentra un producto Nike:
# ğŸš« PRODUCTO BLOQUEADO - Marca prohibida: Nike
#    ASIN: B0ABC123
#    Marca coincide con: Nike
#    â­ï¸  Saltando publicaciÃ³n de este producto
```

### Test Manual

Para probar el sistema de filtrado:

```bash
./venv/bin/python3 src/filters/brand_filter.py
```

---

## ğŸ“Š Ejemplo de Salida

```
ğŸ”„ Procesando B0NIKE123...
ğŸ“¦ Usando JSON transformado (mini_ml) para B0NIKE123

ğŸš« PRODUCTO BLOQUEADO - Marca prohibida: Nike
   ASIN: B0NIKE123
   Marca coincide con: Nike
   â­ï¸  Saltando publicaciÃ³n de este producto

âœ… Producto omitido automÃ¡ticamente
```

---

## ğŸ”§ Agregar/Modificar Marcas Prohibidas

### Agregar nueva marca

1. Editar `config/blocked_brands.json`:

```json
{
  "blocked_brands": [
    "Adidas",
    "Nike",
    "Puma"  â† Nueva marca
  ],
  "updated": "2025-11-08"
}
```

2. Guardar archivo
3. âœ… Ya estÃ¡ activo (no requiere restart)

### Eliminar marca de la lista

1. Editar `config/blocked_brands.json`
2. Eliminar la lÃ­nea de la marca
3. Guardar

**Importante**: UsÃ¡ comillas dobles `"`, no comillas simples `'`

---

## ğŸ§ª Testing

### Probar si una marca estÃ¡ bloqueada

```bash
# Ejecutar test del mÃ³dulo
./venv/bin/python3 src/filters/brand_filter.py
```

### Verificar manualmente desde Python

```python
from src.filters.brand_filter import is_brand_blocked

# Test
result = is_brand_blocked("Nike")
print(result)
# {'is_blocked': True, 'brand': 'Nike', 'matched_brand': 'Nike'}

result = is_brand_blocked("LEGO")
print(result)
# {'is_blocked': False, 'brand': 'LEGO', 'matched_brand': None}
```

---

## ğŸ“ˆ EstadÃ­sticas

Para ver cuÃ¡ntos productos fueron bloqueados:

```bash
# Ver logs del pipeline
grep "PRODUCTO BLOQUEADO" logs/*.log

# Contar bloqueados por marca
grep "Marca coincide con" logs/*.log | sort | uniq -c
```

---

## â“ FAQ

**Â¿QuÃ© pasa con los productos bloqueados?**

Se saltean automÃ¡ticamente. No se publican, no generan errores, simplemente el pipeline continÃºa con el siguiente producto.

**Â¿Puedo publicar productos Nike si tengo autorizaciÃ³n?**

SÃ­, simplemente eliminÃ¡ "Nike" de `config/blocked_brands.json`.

**Â¿El filtro verifica variantes (colores, tamaÃ±os)?**

SÃ­, el filtro se aplica a la marca base. Si "Nike" estÃ¡ bloqueado, todas las variantes de Nike se bloquean tambiÃ©n.

**Â¿Funciona para todos los marketplaces (MÃ©xico, Brasil)?**

SÃ­, el filtro es global. Si una marca estÃ¡ bloqueada, no se publica en ningÃºn paÃ­s.

**Â¿QuÃ© pasa si Amazon no provee la marca?**

Si el campo "brand" estÃ¡ vacÃ­o, el producto se considera "sin marca" y NO se bloquea (pasa el filtro).

**Â¿Puedo usar wildcards o regex?**

Actualmente no. El sistema solo soporta strings exactos o parciales. Si necesitÃ¡s regex, podÃ©s modificar `src/filters/brand_filter.py`.

---

## ğŸ” DÃ³nde se aplica el filtro

```
Pipeline de publicaciÃ³n:
  1. Descargar ASIN de Amazon          â† No filtrado aÃºn
  2. Transformar a formato ML          â† No filtrado aÃºn
  3. Encontrar categorÃ­a CBT           â† No filtrado aÃºn
  4. Preparar para publicaciÃ³n (mini_ml)
  5. â†’ FILTRO DE MARCAS â†              âœ… SE APLICA AQUÃ
  6. Publicar en MercadoLibre          â† Solo si pasÃ³ filtro
```

**Resultado**: Se ahorra el request de publicaciÃ³n a MercadoLibre, pero ya se procesÃ³ el producto (descarga de Amazon, transformaciÃ³n, categorizaciÃ³n).

---

## ğŸ’¡ Mejora Futura Posible

Si querÃ©s ahorrar mÃ¡s tiempo/tokens, podÃ©s mover el filtro mÃ¡s arriba en el pipeline:

**OpciÃ³n A: Filtrar despuÃ©s de descargar de Amazon**
- Ahorra: procesamiento, IA, categorizaciÃ³n
- Requiere: leer el JSON de Amazon directamente

**OpciÃ³n B: Filtrar desde la bÃºsqueda de ASINs**
- Ahorra: descarga de Amazon tambiÃ©n
- Requiere: consulta adicional a Amazon API para obtener marca

Por ahora estÃ¡ al final porque es el punto mÃ¡s seguro (ya tenemos todos los datos procesados).

---

## ğŸ“ Archivos del Sistema

```
config/
  blocked_brands.json               # Lista de marcas prohibidas (editable)

src/
  filters/
    brand_filter.py                 # Motor de filtrado de marcas
    __init__.py

  integrations/
    mainglobal.py                   # IntegraciÃ³n del filtro (lÃ­nea 1098-1106)
```

---

## ğŸ¬ Ejemplo Completo

```bash
# Buscar productos Nike (para demostraciÃ³n)
./search_asins.sh "nike shoes" 10

# Ejecutar pipeline
./venv/bin/python3 src/integrations/mainglobal.py

# Salida esperada:
# ğŸ“¦ Procesando B0NIKE001...
# ğŸš« PRODUCTO BLOQUEADO - Marca prohibida: Nike
#    â­ï¸  Saltando publicaciÃ³n
#
# ğŸ“¦ Procesando B0NIKE002...
# ğŸš« PRODUCTO BLOQUEADO - Marca prohibida: Nike
#    â­ï¸  Saltando publicaciÃ³n
#
# ... todos los Nike bloqueados automÃ¡ticamente
```

---

## âš–ï¸ Legal

Este filtro es una herramienta de prevenciÃ³n. Es responsabilidad del usuario:
- Mantener la lista actualizada segÃºn polÃ­ticas de MercadoLibre
- Verificar restricciones de propiedad intelectual en su paÃ­s
- Obtener autorizaciones necesarias para vender marcas especÃ­ficas

---

ğŸ¤– Sistema de protecciÃ³n automÃ¡tica contra marcas restringidas
