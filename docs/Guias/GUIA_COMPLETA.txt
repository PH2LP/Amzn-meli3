# ğŸ“š GUÃA COMPLETA - Sistema Amazon â†’ MercadoLibre

**VersiÃ³n:** 2.0
**Ãšltima actualizaciÃ³n:** 2025-11-09

---

## ğŸ“– ÃNDICE

1. [Inicio RÃ¡pido](#inicio-rÃ¡pido)
2. [Sistema AutÃ³nomo](#sistema-autÃ³nomo)
3. [BÃºsqueda de Productos](#bÃºsqueda-de-productos)
4. [Precios DinÃ¡micos](#precios-dinÃ¡micos)
5. [SincronizaciÃ³n](#sincronizaciÃ³n)
6. [CorrecciÃ³n de Fotos](#correcciÃ³n-de-fotos)
7. [Tokens AutomÃ¡ticos](#tokens-automÃ¡ticos)
8. [Servicios en Loop](#servicios-en-loop)
9. [Filtros y Seguridad](#filtros-y-seguridad)
10. [Troubleshooting](#troubleshooting)

---

## ğŸš€ INICIO RÃPIDO

### Comandos Esenciales

```bash
# Instalar servicio de tokens (una sola vez)
./scripts/auth/install_ml_token_service.sh

# Iniciar sistema autÃ³nomo
./start_autonomous.sh

# Activar todos los servicios
./start_all_services.sh

# Verificar estado
./check_services_status.sh
```

### Publicar un Producto Manualmente

```bash
# 1. Agregar ASIN
echo "B0CYM126TT" > asins.txt

# 2. Publicar
./venv/bin/python3 src/integrations/mainglobal.py

# 3. Verificar
sqlite3 storage/listings_database.db "SELECT * FROM listings ORDER BY rowid DESC LIMIT 1;"
```

---

## ğŸ¤– SISTEMA AUTÃ“NOMO

### Â¿QuÃ© hace?

El sistema autÃ³nomo es el **cerebro** del sistema. Funciona 24/7 sin intervenciÃ³n:

1. Lee 7,028 keywords ordenadas por popularidad (DataForSEO)
2. Busca productos en Amazon para cada keyword
3. Ordena por BSR (Best Seller Rank - mÃ¡s vendidos primero)
4. Analiza calidad y decide cuÃ¡ntos publicar (15-60 por keyword)
5. Publica automÃ¡ticamente en MercadoLibre
6. ContinÃºa hasta alcanzar 50,000 publicaciones

### Iniciar Sistema AutÃ³nomo

```bash
# Modo PRODUCCIÃ“N (publica productos reales)
./start_autonomous.sh

# Modo TEST (simula sin publicar)
./start_autonomous.sh --dry-run

# Test de 1 ciclo (procesa solo 1 keyword)
./venv/bin/python3 scripts/autonomous/autonomous_search_and_publish.py --max-cycles 1
```

### Monitorear Progreso

```bash
# Ver logs en tiempo real
tail -f storage/autonomous_logs/autonomous_system.log

# Ver estadÃ­sticas
./venv/bin/python3 scripts/autonomous/fetch_popular_keywords.py --stats

# Output esperado:
# ============================================================
# ğŸ“Š ESTADÃSTICAS DE PROGRESO
# ============================================================
# Keywords totales:     7,028
# Keywords procesadas:  142
# Keywords pendientes:  6,886
# Publicaciones:        3,580 / 50,000
# Progreso:             7.2%
# ============================================================
```

### Detener Sistema

```bash
# MÃ©todo 1: Script de stop
./stop_autonomous.sh

# MÃ©todo 2: Emergency stop file
touch storage/STOP_AUTONOMOUS

# MÃ©todo 3: Kill process
kill $(cat storage/autonomous.pid)
```

### ConfiguraciÃ³n del Sistema AutÃ³nomo

**Archivo:** `config/autonomous_config.json`

```json
{
  "autonomous_mode": {
    "max_publications_per_cycle": 50,
    "max_publications_per_day": 500,
    "max_total_publications": 50000,
    "cycle_delay_minutes": 30
  }
}
```

**Archivo:** `config/quality_config.json`

```json
{
  "publication_rules": {
    "publish_all": {
      "min_avg_score": 85,
      "max_count": 60,
      "description": "EXCELLENT - publicar hasta 60 ASINs"
    },
    "publish_most": {
      "min_avg_score": 65,
      "max_count": 35,
      "description": "VERY GOOD - publicar hasta 35 ASINs"
    },
    "publish_some": {
      "min_avg_score": 50,
      "max_count": 25,
      "description": "REGULAR - publicar hasta 25 ASINs"
    },
    "publish_few": {
      "min_avg_score": 35,
      "max_count": 15,
      "description": "LOW - publicar hasta 15 ASINs"
    }
  }
}
```

### Proyecciones

Con 7,028 keywords:

| Tier Calidad | Score | ASINs/Keyword | % Keywords | Publicaciones |
|--------------|-------|---------------|------------|---------------|
| EXCELLENT    | 85+   | 40            | 15%        | 42,168        |
| VERY GOOD    | 65-84 | 25            | 35%        | 61,490        |
| REGULAR      | 50-64 | 20            | 40%        | 56,224        |
| LOW          | 35-49 | 13            | 10%        | 9,136         |
| **TOTAL**    |       | **~24**       | **100%**   | **~169,018**  |

---

## ğŸ” BÃšSQUEDA DE PRODUCTOS

### Alternativa GRATIS a Helium 10

```bash
# Buscar 500 ASINs, guardar top 50 por BSR
./venv/bin/python3 scripts/tools/search_asins_by_keyword.py "wireless keyboard" 500 50

# Con BSR ranking (mÃ¡s vendidos primero)
./venv/bin/python3 scripts/tools/search_asins_by_keyword.py "lego" 1000 100 lego_top100.txt

# Agregar al archivo existente (append)
./venv/bin/python3 scripts/tools/search_asins_by_keyword.py "gaming mouse" 200 --append
```

### Modo Interactivo

```bash
# Sin argumentos = modo interactivo
./venv/bin/python3 scripts/tools/search_asins_by_keyword.py
```

### CÃ³mo Funciona el BSR

**BSR (Best Seller Rank):**
- BSR bajo = mÃ¡s vendido (ej: BSR 47 es mejor que BSR 1,000)
- El script ordena automÃ¡ticamente por BSR
- Solo guarda los top N productos mÃ¡s vendidos

**Ejemplo:**
```
BÃºsqueda: "wireless earbuds" (500 ASINs)
Resultados con BSR:
  1. B09NY9MMS3 - BSR: 47       â† Top vendedor
  2. B09KZ6TBNY - BSR: 151
  3. B085S61L6K - BSR: 322
  ...
  500. B001BO0L1W - BSR: 19,807  â† Menos vendido
```

### Tiempos de BÃºsqueda

- 50 ASINs: ~10 segundos
- 100 ASINs: ~20 segundos
- 500 ASINs: ~2 minutos
- 1000 ASINs: ~4 minutos

---

## ğŸ’° PRECIOS DINÃMICOS

### Â¿QuÃ© hace?

El sistema ajusta precios automÃ¡ticamente para:
- **Ganar el buybox** (cajita de compra de ML)
- **Maximizar ganancias** cuando ya tenÃ©s el buybox
- **Proteger margen mÃ­nimo** (25% por default)

### CÃ³mo Funciona

```
Para cada producto en catÃ¡logo (cada 30 min):

1. Â¿TenÃ©s el buybox?
   â”‚
   â”œâ”€ SÃ â†’ Subir precio +2%
   â”‚        (Maximizar ganancia manteniendo buybox)
   â”‚
   â””â”€ NO â†’ Â¿CuÃ¡nto cuesta el competidor mÃ¡s barato?
           â”‚
           â”œâ”€ Competidor muy barato (<25% margen)
           â”‚  â†’ NO bajar precio (proteger margen)
           â”‚
           â””â”€ Competidor razonable
              â†’ Bajar a 1% menos que Ã©l
                (Ganar buybox con margen aceptable)
```

### Activar Sistema

```bash
# Iniciar monitor automÃ¡tico
nohup ./scripts/tools/monitor_catalog_loop.sh > /dev/null 2>&1 &

# Verificar que estÃ¡ activo
ps aux | grep monitor_catalog
```

### Comandos Manuales

```bash
# Ver productos en catÃ¡logo
./venv/bin/python3 scripts/tools/check_catalog_items.py

# Simular ajuste (sin cambiar nada)
./venv/bin/python3 scripts/tools/adjust_catalog_prices.py --dry-run

# Ejecutar ajuste real
./venv/bin/python3 scripts/tools/adjust_catalog_prices.py
```

### ConfiguraciÃ³n

**Archivo:** `.env`

```bash
# Margen inicial al publicar
PRICE_MARKUP=45              # 45% de ganancia

# Margen mÃ­nimo a proteger
MARGEN_MINIMO=25             # Nunca bajar de 25%
```

### Ejemplo Real

```
Producto: Teclado Logitech K380
Amazon: $29.99

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CICLO 1 (PublicaciÃ³n inicial)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Precio Amazon: $29.99                                       â”‚
â”‚ Markup: +45%                                                â”‚
â”‚ Precio ML: $43.48                                           â”‚
â”‚ Â¿Buybox?: NO (competidor vende a $40.00)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CICLO 2 (30 min despuÃ©s - ajuste automÃ¡tico)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Detecta: NO tenÃ©s buybox                                    â”‚
â”‚ Competidor: $40.00                                          â”‚
â”‚ AcciÃ³n: Bajar a $39.60 (-1% del competidor)                â”‚
â”‚ Margen: 32% (OK - mayor a 25%)                             â”‚
â”‚ âœ… Precio actualizado                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CICLO 3 (30 min despuÃ©s)                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Detecta: Â¡Ahora SÃ tenÃ©s buybox!                           â”‚
â”‚ AcciÃ³n: Subir precio +2% â†’ $40.39                          â”‚
â”‚ Margen: 34.6%                                               â”‚
â”‚ âœ… Maximizando ganancia                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ SINCRONIZACIÃ“N

### Â¿QuÃ© hace?

Sincroniza automÃ¡ticamente:
- **Precios** de Amazon â†’ MercadoLibre (cada 6h)
- **Stock** de Amazon â†’ MercadoLibre (pausa si stock=0)

### Activar SincronizaciÃ³n

```bash
# Iniciar loop automÃ¡tico
nohup ./scripts/tools/sync_amazon_ml_loop.sh > /dev/null 2>&1 &

# Verificar que estÃ¡ activo
ps aux | grep sync_amazon_ml
```

### EjecuciÃ³n Manual

```bash
# Sincronizar una vez
./venv/bin/python3 scripts/tools/sync_amazon_ml.py

# Ver Ãºltimos cambios
tail -50 logs/sync_amazon_ml.log
```

### ConfiguraciÃ³n

**Frecuencia:** Editar `scripts/tools/sync_amazon_ml_loop.sh`

```bash
# Cambiar 6 horas a 3 horas
sleep 10800  # 3 * 60 * 60 = 10800 segundos
```

---

## ğŸ–¼ï¸ CORRECCIÃ“N DE FOTOS

### Â¿QuÃ© hace?

Detecta y corrige automÃ¡ticamente publicaciones pausadas por problemas de fotos:
- Descarga foto original de Amazon
- Sube a ImgBB (hosting gratuito)
- Actualiza publicaciÃ³n con nueva URL
- Reactiva publicaciÃ³n

### Activar Sistema

```bash
# Configurar API key de ImgBB (gratis)
echo "IMGBB_API_KEY=tu_api_key" >> .env

# Iniciar loop automÃ¡tico
./scripts/tools/setup_picture_fixer.sh
```

### EjecuciÃ³n Manual

```bash
# Corregir fotos pausadas una vez
./venv/bin/python3 scripts/tools/fix_paused_pictures.py

# Ver log
tail -50 logs/fix_paused_pictures.log
```

---

## ğŸ”‘ TOKENS AUTOMÃTICOS

### Sistema de Auto-RenovaciÃ³n

**Amazon:**
- CachÃ© inteligente on-demand
- Se renueva automÃ¡ticamente cuando expira
- No requiere configuraciÃ³n adicional

**MercadoLibre:**
- LaunchAgent que corre cada 5.5 horas
- Renueva token automÃ¡ticamente
- Persiste entre reinicios del sistema

### InstalaciÃ³n (Una sola vez)

```bash
# Instalar servicio de ML token
./scripts/auth/install_ml_token_service.sh

# Verificar instalaciÃ³n
launchctl list | grep ml_token

# Ver log
tail -f logs/ml_token_refresh.log
```

### Verificar Tokens

```bash
# Token Amazon (cachÃ©)
cat cache/amazon_token.json

# Token ML (en .env)
grep ML_ACCESS_TOKEN .env

# Servicio ML activo
launchctl list | grep ml_token
```

---

## ğŸ”„ SERVICIOS EN LOOP

### Activar Todos los Servicios

```bash
# Un solo comando para TODO
./start_all_services.sh

# Verificar estado
./check_services_status.sh

# Detener todo
./stop_all_services.sh
```

### Servicios Disponibles

1. **Token ML Refresh** - Auto-renovaciÃ³n de tokens (LaunchAgent)
2. **Sync Amazon-ML** - SincronizaciÃ³n cada 6h
3. **Monitor CatÃ¡logo** - Precios dinÃ¡micos cada 30 min
4. **Auto Adjust Prices** - Ajuste de precios
5. **Fix Paused Pictures** - CorrecciÃ³n de fotos cada 30 min
6. **Auto Responder** - Respuestas automÃ¡ticas cada 1 min

### Servicios Individuales

```bash
# SincronizaciÃ³n (cada 6h)
nohup ./scripts/tools/sync_amazon_ml_loop.sh > /dev/null 2>&1 &

# Monitor de catÃ¡logo (cada 30 min)
nohup ./scripts/tools/monitor_catalog_loop.sh > /dev/null 2>&1 &

# CorrecciÃ³n de fotos (cada 30 min)
nohup ./scripts/tools/fix_paused_pictures_loop.sh > /dev/null 2>&1 &
```

---

## ğŸ›¡ï¸ FILTROS Y SEGURIDAD

### DetecciÃ³n de Duplicados

**Â¿QuÃ© previene?**
- Reprocesar ASINs ya publicados
- Desperdiciar tokens de OpenAI
- Errores de MercadoLibre por duplicados

**Uso:**
```bash
# Pipeline inteligente (con detecciÃ³n automÃ¡tica)
./venv/bin/python3 run_pipeline_smart.py

# Verificar duplicados sin ejecutar
./venv/bin/python3 src/pipeline/duplicate_checker.py
```

**CÃ³mo funciona:**
1. Verifica ASIN en base de datos
2. Verifica GTIN/UPC (cÃ³digo de barras)
3. Si ya existe â†’ Saltea automÃ¡ticamente

### Marcas Prohibidas

**Marcas bloqueadas automÃ¡ticamente:**
- Adidas, Nike, Converse
- Ralph Lauren, Carolina Herrera
- LancÃ´me, Kiehl's, Urban Decay
- Y mÃ¡s...

**Editar lista:**

Archivo: `config/blocked_brands.json`

```json
{
  "blocked_brands": [
    "Nike",
    "Adidas",
    "Tu Marca AquÃ­"
  ],
  "updated": "2025-11-09"
}
```

**Uso:**
- AutomÃ¡tico (integrado en pipeline)
- No requiere configuraciÃ³n adicional
- Solo agrega/quita marcas del JSON

---

## ğŸ†˜ TROUBLESHOOTING

### Error: "Token expirado (401)"

```bash
# Verificar servicio de tokens
launchctl list | grep ml_token

# Ver log
tail -50 logs/ml_token_refresh.log

# Reinstalar servicio
./scripts/auth/install_ml_token_service.sh
```

### Sistema autÃ³nomo no encuentra keywords

```bash
# Verificar archivo existe
ls -lh config/master_keywords.json

# Ver estadÃ­sticas
./venv/bin/python3 scripts/autonomous/fetch_popular_keywords.py --stats

# Si no existe, ejecutar discovery ($5-6 costo)
./venv/bin/python3 scripts/autonomous/fetch_popular_keywords.py --fetch --depth 2
```

### Errores de categorÃ­a

```bash
# Ver Ãºltimos errores
tail -100 logs/main2.log | grep ERROR

# Regenerar schemas de ML
./scripts/tools/regenerate_all_schemas.sh
```

### Base de datos corrupta

```bash
# Backup
cp storage/listings_database.db storage/listings_database.db.backup

# Verificar integridad
sqlite3 storage/listings_database.db "PRAGMA integrity_check;"
```

### Servicios no estÃ¡n activos

```bash
# Ver procesos activos
ps aux | grep -E "(loop|sync|monitor)" | grep -v grep

# Reiniciar todos los servicios
./stop_all_services.sh
./start_all_services.sh
```

---

## ğŸ“ ARCHIVOS IMPORTANTES

```
ğŸ“‚ /Users/felipemelucci/Desktop/revancha/
â”‚
â”œâ”€â”€ COMO_USAR.md                         # GuÃ­a rÃ¡pida de uso
â”œâ”€â”€ REPORTE_VERIFICACION_SISTEMA.md      # Estado del sistema
â”‚
â”œâ”€â”€ .env                                 # Credenciales y config
â”œâ”€â”€ asins.txt                            # ASINs a publicar
â”‚
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ master_keywords.json             # 7,028 keywords listas
â”‚   â”œâ”€â”€ autonomous_config.json           # Config sistema autÃ³nomo
â”‚   â”œâ”€â”€ quality_config.json              # LÃ­mites de publicaciÃ³n
â”‚   â””â”€â”€ blocked_brands.json              # Marcas prohibidas
â”‚
â”œâ”€â”€ storage/
â”‚   â”œâ”€â”€ listings_database.db             # Base de datos principal
â”‚   â”œâ”€â”€ pipeline_state.db                # Estado del pipeline
â”‚   â””â”€â”€ autonomous_logs/                 # Logs del sistema autÃ³nomo
â”‚
â”œâ”€â”€ logs/                                # Logs de todos los mÃ³dulos
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ autonomous/                      # Sistema autÃ³nomo
â”‚   â”œâ”€â”€ tools/                           # Herramientas
â”‚   â””â”€â”€ auth/                            # Tokens automÃ¡ticos
â”‚
â””â”€â”€ src/
    â”œâ”€â”€ integrations/
    â”‚   â””â”€â”€ mainglobal.py                # Pipeline principal
    â”œâ”€â”€ pipeline/                        # TransformaciÃ³n y categorÃ­as
    â””â”€â”€ filters/                         # Duplicados y marcas

```

---

## ğŸ¯ CHECKLIST DE PRODUCCIÃ“N

- [ ] `.env` configurado con todas las credenciales
- [ ] Servicio de tokens ML instalado
- [ ] Keywords descubiertas (7,028 listas)
- [ ] `MARGEN_MINIMO=25` agregado al .env
- [ ] Sistema autÃ³nomo iniciado
- [ ] Todos los servicios activos
- [ ] Monitoreo configurado (logs, Telegram)

---

**Sistema completo y documentado - Listo para 169,000+ publicaciones automÃ¡ticas** ğŸš€
