# ğŸŒ©ï¸ Plan de MigraciÃ³n a VPS - GuÃ­a Completa

**IMPORTANTE:** Este documento es para **FUTURO**, cuando el sistema estÃ© completo y listo para producciÃ³n 24/7.

---

## ğŸ“Œ Contexto

### Â¿Por quÃ© migrar a VPS?

**AHORA:**
- Todo corre en la Mac de Felipe
- Si se apaga la Mac, todo deja de funcionar
- No hay backups automÃ¡ticos en la nube
- Depende de tener la Mac prendida 24/7

**DESPUÃ‰S (con VPS):**
- Todo corre en un servidor en la nube 24/7
- Nunca se apaga
- Mac puede estar apagada o viajando
- Backups automÃ¡ticos
- Internet mÃ¡s rÃ¡pido (datacenter)

---

## ğŸ¯ CuÃ¡ndo Migrar

**Migrar cuando:**
- âœ… El sistema estÃ© funcionando perfectamente en local
- âœ… Tengas productos publicados exitosamente
- âœ… El sync funcione correctamente
- âœ… El auto-responder estÃ© probado
- âœ… Las notificaciones de Telegram funcionen
- âœ… Todo el cÃ³digo estÃ© en GitHub
- âœ… EstÃ©s listo para invertir $6/mes

**NO migrar si:**
- âŒ TodavÃ­a hay bugs en el cÃ³digo
- âŒ EstÃ¡s haciendo cambios frecuentes
- âŒ No has probado el sistema completo
- âŒ Prefieres desarrollo local por ahora

---

## ğŸ’° Costos Estimados

### OpciÃ³n Recomendada: DigitalOcean
- **Plan:** Basic Droplet
- **Specs:** 1 CPU, 1GB RAM, 25GB SSD, 1TB transfer
- **Costo:** $6/mes ($0.009/hora)
- **Backups:** +$1.20/mes (opcional pero recomendado)
- **Total:** ~$7/mes

### Alternativas:
- **Linode/Akamai:** $5/mes (similar specs)
- **Vultr:** $6/mes (similar specs)
- **Hetzner:** â‚¬4/mes (~$4.30, pero en Europa)

---

## ğŸ“‹ Checklist Pre-MigraciÃ³n

Antes de empezar la migraciÃ³n, verificar:

### 1. CÃ³digo y ConfiguraciÃ³n
- [ ] Todo el cÃ³digo estÃ¡ en GitHub (repositorio privado)
- [ ] El archivo `.env` tiene todas las credenciales actualizadas
- [ ] `requirements.txt` tiene todas las dependencias
- [ ] Los scripts shell tienen permisos de ejecuciÃ³n
- [ ] No hay rutas absolutas hardcodeadas (usar rutas relativas)

### 2. Funcionalidades Probadas
- [ ] Pipeline principal (`main2.py`) funciona correctamente
- [ ] Auto-responder responde preguntas correctamente
- [ ] Sync de Amazon-ML funciona sin errores
- [ ] Notificaciones de Telegram llegan correctamente
- [ ] Base de datos SQLite no estÃ¡ corrupta

### 3. DocumentaciÃ³n
- [ ] README.md estÃ¡ actualizado
- [ ] DocumentaciÃ³n de cada mÃ³dulo existe
- [ ] Variables de entorno documentadas
- [ ] Comandos de uso documentados

### 4. Credenciales Necesarias
- [ ] MercadoLibre Access Token vÃ¡lido
- [ ] Amazon SP-API credentials
- [ ] Telegram Bot Token
- [ ] Telegram Chat ID
- [ ] OpenAI API Key (si aplica)

---

## ğŸš€ Plan de MigraciÃ³n en 3 Fases

### **FASE 1: PreparaciÃ³n (Felipe hace - 10 minutos)**

#### Paso 1.1: Crear Cuenta DigitalOcean
1. Ir a https://www.digitalocean.com
2. Click "Sign Up"
3. Ingresar email y contraseÃ±a
4. Verificar email
5. Agregar mÃ©todo de pago (tarjeta de crÃ©dito)
6. **Bonus:** Aplicar cÃ³digo promocional para $200 de crÃ©dito gratis (60 dÃ­as)

#### Paso 1.2: Crear el Droplet (VPS)
1. Click en "Create" â†’ "Droplets"
2. Elegir configuraciÃ³n:
   ```
   DistribuciÃ³n: Ubuntu 22.04 LTS (x64)
   Plan: Basic
   CPU: Regular - $6/mes
   Datacenter: New York 1 (o el mÃ¡s cercano)
   AutenticaciÃ³n: Password (elegir contraseÃ±a fuerte)
   Hostname: revancha-prod
   ```
3. **OPCIONAL:** Habilitar backups (+$1.20/mes)
4. Click "Create Droplet"
5. Esperar 60 segundos
6. **COPIAR LA IP:** Ej: `159.89.123.45`
7. **Guardar la contraseÃ±a** que elegiste

#### Paso 1.3: Proporcionar Datos
Compartir con Claude:
- IP del VPS: `159.89.123.45`
- ContraseÃ±a: `********` (o mejor, configurar SSH key)

---

### **FASE 2: Deploy AutomÃ¡tico (Claude hace - 10 minutos)**

Una vez con la IP, Claude ejecutarÃ¡ el script de deploy automÃ¡tico.

#### Paso 2.1: Verificar ConexiÃ³n
```bash
# Desde la Mac de Felipe
ssh root@159.89.123.45

# Si es la primera vez, pregunta:
# "Are you sure you want to continue connecting?"
# Responder: yes

# Pedir contraseÃ±a
# Escribir la contraseÃ±a del VPS
```

#### Paso 2.2: Ejecutar Deploy AutomÃ¡tico
```bash
# Claude ejecutarÃ¡ (o Felipe copia y pega):
./scripts/vps/deploy_to_vps.sh 159.89.123.45

# Este script harÃ¡ AUTOMÃTICAMENTE:
# âœ… Actualizar el sistema
# âœ… Instalar Python, Git, Screen
# âœ… Clonar el repositorio
# âœ… Crear entorno virtual
# âœ… Instalar dependencias
# âœ… Copiar archivo .env
# âœ… Configurar permisos
# âœ… Crear directorios necesarios
```

#### Paso 2.3: Iniciar Servicios
```bash
# Claude ejecutarÃ¡:
./scripts/vps/start_services.sh

# Este script iniciarÃ¡:
# âœ… Auto-responder (screen session)
# âœ… Telegram notifier (screen session)
# âœ… Cron job para sync (cada 3 dÃ­as)
```

---

### **FASE 3: VerificaciÃ³n (Claude + Felipe - 5 minutos)**

#### Paso 3.1: Verificar Servicios
```bash
# Conectar al VPS
ssh root@159.89.123.45

# Ver sesiones de screen activas
screen -ls

# Output esperado:
# There are screens on:
#   12345.responder   (Detached)
#   12346.telegram    (Detached)
```

#### Paso 3.2: Verificar Logs
```bash
# Ver log de auto-responder
tail -f /root/revancha/logs/auto_answer.log

# Ver log de Telegram
tail -f /root/revancha/logs/telegram_notifier_loop.log

# Ver cron jobs
crontab -l
```

#### Paso 3.3: Pruebas Funcionales
- [ ] Auto-responder: Hacer una pregunta en MercadoLibre y verificar respuesta
- [ ] Telegram: Verificar que lleguen notificaciones (si hay ventas)
- [ ] Sync: Ejecutar manualmente y verificar que funcione

---

## ğŸ“š Scripts que Crearemos para el Deploy

### 1. `scripts/vps/deploy_to_vps.sh`
Script principal de deploy que:
- Configura el VPS desde cero
- Instala todas las dependencias
- Clona el repositorio
- Copia credenciales
- Configura entorno

### 2. `scripts/vps/start_services.sh`
Inicia todos los servicios:
- Auto-responder en screen
- Telegram notifier en screen
- Configura cron jobs

### 3. `scripts/vps/monitor.sh`
Monitorea el estado del sistema:
- Verifica que los servicios estÃ©n corriendo
- Muestra uso de CPU/RAM
- Muestra Ãºltimas lÃ­neas de logs

### 4. `scripts/vps/update.sh`
Actualiza el cÃ³digo en el VPS:
- Hace `git pull`
- Reinstala dependencias si es necesario
- Reinicia servicios

### 5. `scripts/vps/backup.sh`
Crea backup de la base de datos y configuraciÃ³n:
- Exporta SQLite database
- Copia archivos importantes
- Guarda en directorio de backups

---

## ğŸ”§ AdministraciÃ³n Post-MigraciÃ³n

### Conectarse al VPS
```bash
ssh root@159.89.123.45
```

### Ver Estado de Servicios
```bash
# Listar sesiones de screen
screen -ls

# Conectarse a una sesiÃ³n
screen -r responder

# Salir sin cerrar (Ctrl+A, luego D)
```

### Ver Logs en Tiempo Real
```bash
# Auto-responder
tail -f logs/auto_answer.log

# Telegram notifier
tail -f logs/telegram_notifier_loop.log

# Sync
tail -f logs/sync_cron.log
```

### Actualizar CÃ³digo
```bash
# Desde la Mac, actualizar el repo
git push

# Conectarse al VPS
ssh root@159.89.123.45

# Ejecutar script de actualizaciÃ³n
cd /root/revancha
./scripts/vps/update.sh
```

### Reiniciar un Servicio
```bash
# Conectarse a la sesiÃ³n
screen -r responder

# Detener (Ctrl+C)

# Reiniciar
./scripts/tools/auto_responder_loop.sh

# Salir (Ctrl+A, D)
```

### Ver Uso de Recursos
```bash
# CPU y memoria
htop

# Espacio en disco
df -h

# Procesos de Python
ps aux | grep python
```

---

## ğŸš¨ Troubleshooting ComÃºn

### Problema: No puedo conectarme por SSH
**SoluciÃ³n:**
```bash
# Verificar que la IP es correcta
ping 159.89.123.45

# Verificar que el firewall no bloquea SSH
# Ir al panel de DigitalOcean â†’ Networking â†’ Firewalls
```

### Problema: Script no corre en screen
**SoluciÃ³n:**
```bash
# Verificar que screen estÃ¡ instalado
screen --version

# Matar sesiÃ³n vieja y crear nueva
screen -X -S responder quit
screen -S responder
./scripts/tools/auto_responder_loop.sh
```

### Problema: Dependencias no se instalan
**SoluciÃ³n:**
```bash
# Verificar versiÃ³n de Python
python3 --version  # Debe ser 3.10+

# Reinstalar desde cero
rm -rf venv
python3 -m venv venv
source venv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt
```

### Problema: No hay espacio en disco
**SoluciÃ³n:**
```bash
# Ver quÃ© ocupa espacio
du -sh /root/revancha/*

# Limpiar logs viejos
find logs/ -type f -mtime +30 -delete

# Limpiar cache de pip
rm -rf ~/.cache/pip
```

---

## ğŸ“Š Monitoreo y Mantenimiento

### Tareas Diarias (AutomÃ¡ticas)
- âœ… Auto-responder revisa preguntas cada minuto
- âœ… Telegram notifier revisa ventas cada 60 segundos
- âœ… Sistema operativo actualiza paquetes automÃ¡ticamente

### Tareas Semanales (Manuales recomendadas)
- [ ] Revisar logs para detectar errores
- [ ] Verificar uso de disco
- [ ] Revisar que todos los servicios estÃ©n corriendo

### Tareas Mensuales (Manuales recomendadas)
- [ ] Backup manual de la base de datos
- [ ] Actualizar dependencias de Python
- [ ] Revisar costos en DigitalOcean

---

## ğŸ’¾ Estrategia de Backups

### Backup AutomÃ¡tico (DigitalOcean)
Si habilitas backups (+$1.20/mes):
- Se crea snapshot semanal automÃ¡tico
- Se guardan Ãºltimas 4 semanas
- Puedes restaurar el VPS completo

### Backup Manual de Base de Datos
```bash
# Conectarse al VPS
ssh root@159.89.123.45

# Ejecutar script de backup
./scripts/vps/backup.sh

# Esto crea:
# backups/listings_database_20251107.db
# backups/env_backup_20251107.txt (sin credenciales sensibles)
```

### Descargar Backup a tu Mac
```bash
# Desde tu Mac
scp root@159.89.123.45:/root/revancha/backups/*.db ~/Downloads/
```

---

## ğŸ” Seguridad Recomendada

### 1. Configurar SSH Key (En vez de contraseÃ±a)
```bash
# En tu Mac, generar key
ssh-keygen -t ed25519

# Copiar al VPS
ssh-copy-id root@159.89.123.45

# Deshabilitar login por contraseÃ±a
# (solo despuÃ©s de verificar que SSH key funciona)
```

### 2. Crear Usuario No-Root
```bash
# Conectarse al VPS
ssh root@159.89.123.45

# Crear usuario
adduser felipe

# Darle permisos sudo
usermod -aG sudo felipe

# Usar ese usuario en vez de root
```

### 3. Configurar Firewall
```bash
# Permitir solo SSH y HTTP/HTTPS
ufw allow 22/tcp
ufw allow 80/tcp
ufw allow 443/tcp
ufw enable
```

---

## ğŸ“ Checklist Final de VerificaciÃ³n

DespuÃ©s del deploy, verificar:

### Servicios Corriendo
- [ ] `screen -ls` muestra 2 sesiones activas
- [ ] Auto-responder estÃ¡ respondiendo preguntas
- [ ] Telegram notifier envÃ­a notificaciones
- [ ] Cron job estÃ¡ configurado (`crontab -l`)

### Logs Sin Errores
- [ ] `logs/auto_answer.log` sin errores crÃ­ticos
- [ ] `logs/telegram_notifier_loop.log` sin errores crÃ­ticos
- [ ] `logs/sync_cron.log` (cuando se ejecute) funciona

### Base de Datos
- [ ] `storage/listings_database.db` existe y no estÃ¡ corrupta
- [ ] Tiene los productos publicados

### Conectividad
- [ ] APIs de MercadoLibre responden
- [ ] APIs de Amazon responden
- [ ] Telegram bot responde

---

## ğŸ¯ Resultado Final

DespuÃ©s de la migraciÃ³n tendrÃ¡s:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VPS en DigitalOcean (159.89.123.45)               â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚
â”‚                                                    â”‚
â”‚ Corriendo 24/7:                                    â”‚
â”‚  âœ… Auto-responder                                 â”‚
â”‚  âœ… Telegram notifier                              â”‚
â”‚  âœ… Sync cada 3 dÃ­as                               â”‚
â”‚                                                    â”‚
â”‚ Tu Mac puede:                                      â”‚
â”‚  ğŸ’¤ Apagarse                                       â”‚
â”‚  âœˆï¸ Viajar contigo                                 â”‚
â”‚  ğŸ–ï¸ Estar de vacaciones                            â”‚
â”‚                                                    â”‚
â”‚ Y todo sigue funcionando ğŸ‰                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Soporte Durante la MigraciÃ³n

Si algo sale mal:
1. Revisar logs en el VPS
2. Consultar secciÃ³n de Troubleshooting
3. Verificar que credenciales sean correctas
4. En Ãºltimo caso: destruir droplet y crear uno nuevo (solo perdÃ©s $0.05)

---

**Fecha de creaciÃ³n:** Noviembre 2025
**Ãšltima actualizaciÃ³n:** Pendiente de migraciÃ³n
**Estado:** Documento de planificaciÃ³n - NO ejecutar aÃºn

**Cuando estÃ©s listo, busca este documento y seguimos los pasos juntos.** ğŸš€
