# ğŸ¯ Sistema de Precios DinÃ¡micos Inteligente para CatÃ¡logo

## ğŸ“‹ Resumen Ejecutivo

Sistema automatizado que **ajusta precios hacia arriba y hacia abajo** para:
- âœ… Ganar el buybox cuando no lo tienes
- âœ… Maximizar ganancias cuando ya lo tienes
- âœ… Mantener rentabilidad en todo momento

---

## ğŸ”§ CÃ³mo Funciona

### **LÃ³gica de DecisiÃ³n AutomÃ¡tica**

El script analiza tu situaciÃ³n en el catÃ¡logo y decide la mejor estrategia:

#### **CASO 1: Ya tienes el buybox ğŸ†**

**Estrategia:** SUBIR GRADUALMENTE

```
SituaciÃ³n:
  - Tu precio: $70
  - Buybox actual: $70 (tuyo)
  - Precio original (45%): $80
  - Precio mÃ­nimo (25%): $60

DecisiÃ³n:
  â†’ SUBE a $72 (+$2)

RazÃ³n:
  Ya tienes el buybox, puedes vender mÃ¡s caro
  y seguir ganando hasta que aparezca competencia
```

**Beneficio:**
- Maximiza tus ganancias gradualmente
- No pierdes el buybox de golpe
- Llegas al precio Ã³ptimo (45% markup)

---

#### **CASO 2: NO tienes el buybox âŒ**

**Estrategia:** BAJAR PARA GANAR

```
SituaciÃ³n:
  - Tu precio: $75
  - Buybox actual: $72 (competidor)
  - Precio mÃ­nimo (25%): $60

DecisiÃ³n:
  â†’ BAJA a $71 (buybox - $1)

RazÃ³n:
  Necesitas ganar el buybox para vender
  $71 > $60 (mantiene margen rentable)
```

**Beneficio:**
- Ganas el buybox
- Empiezas a vender
- Mantienes rentabilidad

---

#### **CASO 3: Competidor demasiado barato ğŸ’¸**

**Estrategia:** NO COMPETIR

```
SituaciÃ³n:
  - Tu precio: $70
  - Buybox actual: $55 (competidor)
  - Precio mÃ­nimo (25%): $60

DecisiÃ³n:
  â†’ SUBE a $80 (precio original)

RazÃ³n:
  $54 (para ganar) < $60 (mÃ­nimo rentable)
  No es rentable competir, esperar mejor momento
```

**Beneficio:**
- No vendes a pÃ©rdida
- Cuando competidor se quede sin stock, tendrÃ¡s el buybox
- Proteges tu margen

---

## ğŸ”„ Ciclo de Vida Completo

### **Ejemplo Real: Producto LEGO Bonsai**

**ConfiguraciÃ³n:**
- Costo Amazon: $50
- Precio mÃ­nimo (25%): $62.50
- Precio original (45%): $72.50

---

### **ğŸ“… DÃA 1: Aparece competencia**

```
Estado inicial:
  - Tu precio: $72.50
  - Competidor: $70.00
  - Buybox: Competidor âŒ

Script ejecuta:
  â†’ BAJA a $69.00
  â†’ RazÃ³n: "Bajar: ganar buybox manteniendo margen"

Resultado:
  âœ… Ahora tienes el buybox
  âœ… Empiezas a vender a $69
```

---

### **ğŸ“… DÃA 2: Ya tienes el buybox**

```
Estado:
  - Tu precio: $69.00
  - Buybox: Tuyo âœ…
  - Competidor: $70.00 (sin stock o no visible)

Script ejecuta:
  â†’ SUBE a $71.00 (+$2)
  â†’ RazÃ³n: "Subir gradualmente: ya tenemos buybox"

Resultado:
  âœ… Sigues con el buybox
  âœ… Ganas $2 mÃ¡s por venta
```

---

### **ğŸ“… DÃA 3: ContinÃºa la subida**

```
Estado:
  - Tu precio: $71.00
  - Buybox: Tuyo âœ…

Script ejecuta:
  â†’ SUBE a $72.50 (precio original alcanzado)
  â†’ RazÃ³n: "Subir gradualmente: ya tenemos buybox"

Resultado:
  âœ… Llegaste al precio Ã³ptimo
  âœ… MÃ¡ximo margen de ganancia (45%)
```

---

### **ğŸ“… DÃA 4: Precio Ã³ptimo alcanzado**

```
Estado:
  - Tu precio: $72.50
  - Buybox: Tuyo âœ…

Script ejecuta:
  â†’ MANTIENE $72.50
  â†’ RazÃ³n: "Mantener: ya en precio Ã³ptimo con buybox"

Resultado:
  âœ… No cambia nada
  âœ… MÃ¡xima rentabilidad
```

---

### **ğŸ“… DÃA 5: Nuevo competidor mÃ¡s agresivo**

```
Estado:
  - Tu precio: $72.50
  - Nuevo competidor: $68.00
  - Buybox: Competidor âŒ

Script ejecuta:
  â†’ BAJA a $67.00
  â†’ RazÃ³n: "Bajar: ganar buybox manteniendo margen"

Resultado:
  âœ… Recuperas el buybox
  âœ… Sigues rentable ($67 > $62.50 mÃ­nimo)
```

---

### **ğŸ“… DÃA 6: Competidor se queda sin stock**

```
Estado:
  - Tu precio: $67.00
  - Buybox: Tuyo âœ…
  - Sin otros competidores

Script ejecuta:
  â†’ SUBE a $69.00 (+$2)
  â†’ Y seguirÃ¡ subiendo hasta $72.50

Resultado:
  âœ… Recuperas margen gradualmente
  âœ… Vuelves al precio Ã³ptimo
```

---

## âš™ï¸ ConfiguraciÃ³n

### **Variables Principales**

UbicaciÃ³n: `scripts/tools/adjust_catalog_prices.py`

```python
PRICE_MARKUP = 45        # Margen objetivo (%) - Tu precio ideal
MARGEN_MINIMO = 25       # Margen mÃ­nimo (%) - No bajar de aquÃ­
TAX_FLORIDA = 7          # Impuesto (%)

# Incremento de subida (lÃ­nea 261):
precio_tentativo = min(our_price + 2, precios["precio_original"])
#                                  ^
#                                  |
#                        Cambiar este valor para subir mÃ¡s/menos rÃ¡pido
```

### **Ajustes Recomendados**

**Conservador (subida lenta):**
```python
precio_tentativo = min(our_price + 1, precios["precio_original"])
# Sube $1 por ejecuciÃ³n
```

**Agresivo (subida rÃ¡pida):**
```python
precio_tentativo = min(our_price + 5, precios["precio_original"])
# Sube $5 por ejecuciÃ³n
```

**Muy agresivo (subida inmediata):**
```python
nuevo_precio = precios["precio_original"]
# Sube directo al precio original si tienes buybox
```

---

## ğŸš€ Uso

### **Ejecutar Manualmente**

```bash
# Ver quÃ© harÃ­a sin cambiar nada (recomendado primero)
python3 scripts/tools/adjust_catalog_prices.py --dry-run

# Ejecutar y actualizar precios
python3 scripts/tools/adjust_catalog_prices.py

# Solo un producto especÃ­fico
python3 scripts/tools/adjust_catalog_prices.py --asin B0DRW8G3WK
```

### **Automatizar con Cron**

Ejecutar cada 6 horas:

```bash
0 */6 * * * cd /ruta/revancha && /ruta/venv/bin/python3 scripts/tools/adjust_catalog_prices.py >> logs/price_adjustment.log 2>&1
```

Ejecutar diariamente a las 2 AM:

```bash
0 2 * * * cd /ruta/revancha && /ruta/venv/bin/python3 scripts/tools/adjust_catalog_prices.py >> logs/price_adjustment.log 2>&1
```

---

## ğŸ“Š Matriz de Decisiones Completa

| Tu Precio | Buybox | Competidor | AcciÃ³n | Nuevo Precio |
|-----------|--------|------------|--------|--------------|
| $70 | Tuyo âœ… | - | SUBE +$2 | $72 |
| $72 | Tuyo âœ… | - | SUBE +$2 | $74 |
| $80 | Tuyo âœ… | - | MANTIENE | $80 (Ã³ptimo) |
| $75 | Otro âŒ | $72 | BAJA | $71 (gana buybox) |
| $70 | Otro âŒ | $55 | SUBE | $80 (no rentable) |
| $50 | Tuyo âœ… | - | SUBE | $80 (muy bajo) |

---

## ğŸ¯ Beneficios del Sistema

### **MaximizaciÃ³n AutomÃ¡tica de Ganancias**

```
Sin sistema:
  Precio fijo: $70
  Margen: 30%

Con sistema:
  Empieza: $70 (gana buybox)
  Sube a: $72, $74, $76, $78, $80
  Margen final: 45%

  â†’ +15% mÃ¡s de ganancia sin perder ventas
```

### **Competencia Inteligente**

```
Competidor a $72:
  â†’ Bajas a $71 (ganas)

Competidor se va:
  â†’ Subes gradualmente a $80

Competidor muy barato ($50):
  â†’ Mantienes $80 (no compites a pÃ©rdida)
```

### **ProtecciÃ³n de Margen**

```
Nunca baja del 25% de margen:

  Costo real: $50
  MÃ­nimo: $62.50

  Competidor a $60:
    â†’ NO baja a $59
    â†’ Sube a $80 (precio original)
    â†’ Espera mejor momento
```

---

## ğŸ” Monitoreo

### **Ver Estado Actual**

```bash
# Ver quÃ© productos estÃ¡n en catÃ¡logo
python3 scripts/tools/check_catalog_items.py

# Ver quÃ© cambios harÃ­a (sin ejecutar)
python3 scripts/tools/adjust_catalog_prices.py --dry-run
```

### **Revisar Historial**

```bash
# Ver Ãºltimas ejecuciones
tail -100 logs/price_adjustment.log

# Buscar productos especÃ­ficos
grep "B0DRW8G3WK" logs/price_adjustment.log
```

### **Verificar en Base de Datos**

```bash
sqlite3 storage/listings_database.db "
  SELECT
    asin,
    precio_original,
    precio_actual,
    es_catalogo,
    ultima_actualizacion_precio
  FROM listings
  WHERE es_catalogo = 1
  ORDER BY ultima_actualizacion_precio DESC
  LIMIT 10;
"
```

---

## âš ï¸ Consideraciones Importantes

### **1. Frecuencia de EjecuciÃ³n**

**Recomendado:** 2-4 veces por dÃ­a

**RazÃ³n:**
- Subir muy rÃ¡pido puede hacer que pierdas buybox
- Subir muy lento deja dinero sobre la mesa
- 6 horas es un buen balance

### **2. Productos Sin Competencia**

Si tu producto es Ãºnico en catÃ¡logo:
- El script sube inmediatamente al precio original
- No hay buybox que ganar
- Maximizas ganancia desde el inicio

### **3. Productos de Alta RotaciÃ³n**

Para productos que venden mucho:
- Considera subir mÃ¡s lento (+$1 en vez de +$2)
- Mantener buybox es mÃ¡s importante
- PequeÃ±as pÃ©rdidas de margen se compensan con volumen

### **4. Productos de Baja RotaciÃ³n**

Para productos que venden poco:
- Considera subir mÃ¡s rÃ¡pido (+$5 o directo)
- Volumen bajo = priorizar margen
- Buybox menos crÃ­tico

---

## ğŸ› Troubleshooting

### **Problema: Precios no se actualizan**

```bash
# Verificar que el script se ejecuta
python3 scripts/tools/adjust_catalog_prices.py --dry-run

# Verificar token de ML
echo $ML_ACCESS_TOKEN

# Verificar permisos de base de datos
ls -la storage/listings_database.db
```

### **Problema: "No hay productos de catÃ¡logo"**

```bash
# Verificar que productos estÃ¡n marcados como catÃ¡logo
python3 scripts/tools/check_catalog_items.py

# Actualizar manualmente si es necesario
sqlite3 storage/listings_database.db "
  UPDATE listings
  SET es_catalogo = 1
  WHERE item_id = 'CBT2881118766';
"
```

### **Problema: Precios suben/bajan demasiado rÃ¡pido**

Editar lÃ­nea 261 en `adjust_catalog_prices.py`:

```python
# MÃ¡s lento (cambiar de +2 a +1)
precio_tentativo = min(our_price + 1, precios["precio_original"])

# MÃ¡s rÃ¡pido (cambiar de +2 a +5)
precio_tentativo = min(our_price + 5, precios["precio_original"])
```

---

## ğŸ“ˆ MÃ©tricas de Ã‰xito

### **Indicadores Clave**

**Tasa de Buybox:**
```
Objetivo: > 80% del tiempo
MÃ©trica: % de productos con buybox
```

**Margen Promedio:**
```
Objetivo: 35-45%
MÃ©trica: (precio_actual - costo_real) / costo_real
```

**RotaciÃ³n de Precios:**
```
Objetivo: 1-2 cambios por semana por producto
MÃ©trica: Cambios en ultima_actualizacion_precio
```

---

## ğŸ“ Mejores PrÃ¡cticas

### **âœ… DO:**
- Ejecutar 2-4 veces por dÃ­a
- Revisar logs semanalmente
- Ajustar mÃ¡rgenes por categorÃ­a
- Monitorear productos de alto valor

### **âŒ DON'T:**
- Ejecutar cada hora (muy frecuente)
- Bajar margen mÃ­nimo por debajo del 20%
- Ignorar productos sin stock
- Desactivar el sistema sin revisar

---

## ğŸ”® Futuras Mejoras

### **En Roadmap:**

1. **AnÃ¡lisis de Velocidad de Venta**
   - Subir mÃ¡s rÃ¡pido si vendes mucho
   - Subir mÃ¡s lento si ventas caen

2. **DetecciÃ³n de Temporada**
   - Precios mÃ¡s altos en temporada alta
   - MÃ¡s agresivo en temporada baja

3. **Machine Learning**
   - Predecir mejor momento para subir
   - Aprender patrones de competidores

4. **Alertas AutomÃ¡ticas**
   - Notificar cuando pierdes buybox
   - Alertar si competidor muy agresivo

---

## ğŸ“ Soporte

Si tenÃ©s dudas o problemas:

1. Revisar este documento
2. Revisar logs: `logs/price_adjustment.log`
3. Ejecutar con `--dry-run` para ver quÃ© harÃ­a
4. Verificar base de datos con queries SQL

---

## ğŸ‰ ConclusiÃ³n

Este sistema automÃ¡ticamente:

âœ… **Gana el buybox** cuando no lo tienes
âœ… **Maximiza ganancias** cuando lo tienes
âœ… **Protege tu margen** en todo momento
âœ… **Se adapta** a la competencia automÃ¡ticamente

**Resultado:** MÃ¡s ventas + Mayor margen = MÃ¡s ganancias ğŸ’°

---

*Ãšltima actualizaciÃ³n: 2025-01-08*
*VersiÃ³n: 2.0 - Sistema Inteligente con Subida/Bajada*
